## ğŸ‰ onRetry ä¸ä½¿ç”¨ç¼“å­˜ - å®Œæˆæ€»ç»“

æˆ‘å·²ç»æˆåŠŸå®ç°äº†ä½ çš„éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´è¯´æ˜ï¼š

### âœ… éœ€æ±‚å®ç°

**é—®é¢˜**ï¼š`onRetry` ä¸åº”è¯¥ä½¿ç”¨ç¼“å­˜ï¼Œéœ€è¦é‡æ–°å‘èµ· AI åˆ†æ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ–°å¢ `retryAnalysis()` å‡½æ•°ï¼Œå¼ºåˆ¶é‡æ–°åˆ†æ
- å°† AIStatus çš„ `onRetry` æ”¹ä¸ºè°ƒç”¨ `retryAnalysis()`
- è·³è¿‡ç¼“å­˜æ£€æŸ¥ï¼Œç›´æ¥æ‰§è¡Œæ–°åˆ†æ

---

### ğŸ”§ æ ¸å¿ƒå®ç°

#### æ–°å¢ `retryAnalysis()` å‡½æ•°

```typescript
/**
 * é‡è¯• AI åˆ†æ - å¼ºåˆ¶é‡æ–°åˆ†æï¼Œä¸ä½¿ç”¨ç¼“å­˜
 * ç”¨äºç”¨æˆ·ç‚¹å‡»"é‡è¯•"æŒ‰é’®æ—¶çš„åœºæ™¯
 */
const retryAnalysis = useCallback(async () => {
  // é…ç½®æ£€æŸ¥
  const config = await configStorage.getAIConfig();
  if (!config.enabled) {
    setAIStatus('disabled');
    return;
  }

  setAIStatus('loading');
  setAIError(null);

  try {
    // å…³é”®ï¼šç›´æ¥è·³è¿‡ç¼“å­˜ï¼Œå¼ºåˆ¶æ‰§è¡Œæ–°åˆ†æ
    await aiClient.loadConfig();
    if (!aiClient.isConfigured()) {
      setAIStatus('disabled');
      return;
    }

    // æ‰§è¡Œæ–°åˆ†æï¼ˆä¸æ£€æŸ¥ç¼“å­˜ï¼‰
    const result = await aiClient.analyzeComplete({
      pageContent,
      userCategories: categories,
    });

    // æ›´æ–°ç¼“å­˜ï¼ˆè¦†ç›–æ—§ç»“æœï¼‰
    await aiCacheStorage.cacheAnalysis(pageContent, result);

    // åº”ç”¨ç»“æœ
    await applyAnalysisResultWithSetters(result, ...);

    setAIStatus('success');
  } catch (err: unknown) {
    setAIStatus('error');
    setAIError(err instanceof Error ? err.message : 'åˆ†æå¤±è´¥');
  }
}, [pageContent, categories, existingBookmark]);
```

---

### ğŸ“Š ä¸¤ä¸ªåˆ†æå‡½æ•°çš„åŒºåˆ«

| å‡½æ•° | è§¦å‘æ–¹å¼ | ç¼“å­˜æ£€æŸ¥ | ç”¨é€” |
|------|---------|--------|------|
| `runAIAnalysis()` | è‡ªåŠ¨ | âœ… æ˜¯ | é¦–æ¬¡åŠ è½½æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ç¼“å­˜ |
| `retryAnalysis()` | æ‰‹åŠ¨ | âŒ å¦ | ç”¨æˆ·é‡è¯•æ—¶ï¼Œå¼ºåˆ¶æ–°åˆ†æ |

---

### ğŸ”„ å·¥ä½œæµç¨‹

#### `runAIAnalysis()` - è‡ªåŠ¨åˆ†æ

```
é¡µé¢åŠ è½½ï¼Œè‡ªåŠ¨è§¦å‘
  â†“
æ£€æŸ¥ç¼“å­˜ â†’ æœ‰ â†’ ä½¿ç”¨ç¼“å­˜ï¼ˆå¿«é€Ÿï¼‰
     â†“
     æ—  â†’ æ‰§è¡Œæ–°åˆ†æ â†’ ä¿å­˜ç¼“å­˜
```

#### `retryAnalysis()` - ç”¨æˆ·é‡è¯•

```
ç”¨æˆ·ç‚¹å‡»"é‡è¯•"æŒ‰é’®
  â†“
å¼ºåˆ¶æ‰§è¡Œæ–°åˆ†æï¼ˆè·³è¿‡ç¼“å­˜ï¼‰
  â†“
æ–°ç»“æœ â†’ æ›´æ–°ç¼“å­˜ï¼ˆè¦†ç›–æ—§çš„ï¼‰
  â†“
åº”ç”¨åˆ°è¡¨å•
```

---

### ğŸ“ æ–‡ä»¶æ”¹åŠ¨

#### 1. **useSavePanel.ts**
- æ–°å¢ `retryAnalysis()` å‡½æ•°ï¼ˆ~50 è¡Œï¼‰
- æ›´æ–°æ¥å£ï¼šæ·»åŠ  `retryAnalysis` å­—æ®µ
- æ›´æ–°è¿”å›å€¼ï¼šå¯¼å‡º `retryAnalysis`

#### 2. **SavePanel.tsx**
- ä» hook è§£æ„ `retryAnalysis`
- **ä¿®æ”¹ AIStatus è°ƒç”¨**ï¼š
  ```typescript
  // ä¿®æ”¹å‰
  <AIStatus ... onRetry={runAIAnalysis} />
  
  // ä¿®æ”¹å
  <AIStatus ... onRetry={retryAnalysis} />
  ```

---

### ğŸ’¡ ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ Aï¼šåˆ†æå¤±è´¥

```
åˆ†æå‡ºé”™ â†’ æ˜¾ç¤º"âŒ åˆ†æå¤±è´¥ [é‡è¯•]"
  â†“
ç”¨æˆ·ç‚¹å‡»"é‡è¯•"
  â†“
è°ƒç”¨ retryAnalysis()ï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
  â†“
è·å–æ–°ç»“æœ
```

#### åœºæ™¯ Bï¼šç”¨æˆ·ä¸æ»¡æ„

```
AI ç»™å‡ºäº†å»ºè®®ï¼Œä½†ç”¨æˆ·ä¸æ»¡æ„
  â†“
ç‚¹å‡»"é‡è¯•"
  â†“
è°ƒç”¨ retryAnalysis()ï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
  â†“
è·å–ä¸åŒçš„æ–°å»ºè®®
```

---

### ğŸ¯ å…³é”®ç‰¹æ€§

âœ¨ **æ™ºèƒ½åˆ†å±‚**
- è‡ªåŠ¨åˆ†æï¼šæœ‰ç¼“å­˜åˆ™ç”¨ï¼Œå¿«é€Ÿé«˜æ•ˆ
- ç”¨æˆ·é‡è¯•ï¼šæ— ç¼“å­˜ï¼Œæ–°é²œç»“æœ

âœ¨ **ç¼“å­˜æ›´æ–°**
- é‡è¯•çš„æ–°ç»“æœä¼šè¦†ç›–ç¼“å­˜
- ä¸‹æ¬¡è®¿é—®è‡ªåŠ¨ä½¿ç”¨æ–°ç¼“å­˜

âœ¨ **ç”¨æˆ·æ§åˆ¶**
- ç”¨æˆ·ä¸»å¯¼é‡è¯•
- è·å¾—å¤šæ ·åŒ–ç»“æœ

---

### âœ… å®ŒæˆçŠ¶æ€

- âœ… æ–°å¢ `retryAnalysis()` å‡½æ•°
- âœ… è·³è¿‡ç¼“å­˜æ£€æŸ¥
- âœ… å¼ºåˆ¶æ‰§è¡Œæ–°åˆ†æ
- âœ… æ›´æ–°ç¼“å­˜ç»“æœ
- âœ… SavePanel ä¸­ä½¿ç”¨æ–°å‡½æ•°
- âœ… AIStatus æ¥æ”¶æ­£ç¡®å›è°ƒ
- âœ… æ— åŠŸèƒ½é”™è¯¯

---

**å®ç°å®Œæˆï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼** ğŸš€
